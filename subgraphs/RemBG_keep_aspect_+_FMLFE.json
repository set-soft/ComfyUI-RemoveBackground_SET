{"revision":0,"last_node_id":129,"last_link_id":0,"nodes":[{"id":129,"type":"873bd53c-8196-404d-a9ed-745c713c7bfc","pos":[125,150],"size":[300,554],"flags":{},"order":10,"mode":0,"inputs":[{"name":"model","type":"SET_REMBG","link":null},{"name":"target_width","type":"INT","widget":{"name":"target_width"},"link":null},{"name":"target_height","type":"INT","widget":{"name":"target_height"},"link":null},{"label":"norm_params","name":"parameters","type":"NORM_PARAMS","link":null},{"label":"images","name":"get_image_size","type":"IMAGE","link":null}],"outputs":[{"localized_name":"foreground","name":"foreground","type":"IMAGE","links":[]},{"localized_name":"mask","name":"mask","type":"MASK","links":[]}],"properties":{"proxyWidgets":[["-1","target_width"],["-1","target_height"],["36","$$canvas-image-preview"],["126","$$canvas-image-preview"]],"cnr_id":"comfy-core","ver":"0.3.66","widget_ue_connectable":{}},"widgets_values":[512,512],"color":"#332922","bgcolor":"#593930","title":"RemBG keep aspect + FMLFE"}],"links":[],"version":0.4,"definitions":{"subgraphs":[{"id":"873bd53c-8196-404d-a9ed-745c713c7bfc","version":1,"state":{"lastGroupId":9,"lastNodeId":129,"lastLinkId":227,"lastRerouteId":52},"revision":0,"config":{},"name":"RemBG keep aspect + FMLFE","inputNode":{"id":-10,"bounding":[-375,25,120,140]},"outputNode":{"id":-20,"bounding":[2075,200,120,80]},"inputs":[{"id":"d5547f91-ee78-4ec4-9ee3-d100f1b905d3","name":"model","type":"SET_REMBG","linkIds":[218],"pos":[-275,45]},{"id":"effa5df0-fa5a-4831-994f-aff42abe3d9c","name":"target_width","type":"INT","linkIds":[219],"pos":[-275,65]},{"id":"66b6b99f-9e14-44c8-befb-ecf41ef172b4","name":"target_height","type":"INT","linkIds":[220],"pos":[-275,85]},{"id":"e48d146a-dfeb-492c-a5d4-e69d6bf67e6f","name":"parameters","type":"NORM_PARAMS","linkIds":[221],"label":"norm_params","pos":[-275,105]},{"id":"772c66f4-5b2d-4e92-92ff-2ddab63dacdd","name":"get_image_size","type":"IMAGE","linkIds":[222,224,225,226,227],"label":"images","pos":[-275,125]}],"outputs":[{"id":"fd206d8d-16a7-4c05-b8ce-80adabed753e","name":"foreground","type":"IMAGE","linkIds":[127,154,155,156,157],"localized_name":"foreground","pos":[2095,220]},{"id":"6b5fc484-9175-4f6f-8f24-387114ac0e6a","name":"mask","type":"MASK","linkIds":[213,201,202,203,204,205],"localized_name":"mask","pos":[2095,240]}],"widgets":[],"nodes":[{"id":49,"type":"MarkdownNote","pos":[616.4337768554688,0.19090169668197632],"size":[274.0300598144531,111.83796691894531],"flags":{},"order":0,"mode":0,"inputs":[],"outputs":[],"properties":{"ue_properties":{"version":"7.0.1","widget_ue_connectable":{}},"widget_ue_connectable":{}},"widgets_values":["## Model is applied here to get a mask"],"color":"#432","bgcolor":"#653"},{"id":53,"type":"SET_AFFCE","pos":[1540,370],"size":[285.0718688964844,126],"flags":{},"order":8,"mode":0,"inputs":[{"localized_name":"images","name":"images","type":"IMAGE","link":226},{"localized_name":"masks","name":"masks","type":"MASK","link":198},{"localized_name":"blur_size","name":"blur_size","type":"INT","widget":{"name":"blur_size"},"link":null},{"localized_name":"blur_size_two","name":"blur_size_two","type":"INT","widget":{"name":"blur_size_two"},"link":null},{"localized_name":"batched","name":"batched","type":"BOOLEAN","widget":{"name":"batched"},"link":null}],"outputs":[{"localized_name":"foreground","name":"foreground","type":"IMAGE","links":[]},{"localized_name":"mask","name":"mask","type":"MASK","links":null}],"properties":{"cnr_id":"image-misc","ver":"87ee4aebb77a731442e41b595bc8b12a6fd263c3","widget_ue_connectable":{"blur_size":true,"blur_size_two":true,"batched":true},"Node name for S&R":"SET_AFFCE","ue_properties":{"version":"7.0.1","widget_ue_connectable":{"blur_size":true,"blur_size_two":true,"batched":true}}},"widgets_values":[90,6,true],"color":"#233","bgcolor":"#355"},{"id":126,"type":"MaskPreview","pos":[1010,-230],"size":[220,258],"flags":{},"order":11,"mode":0,"inputs":[{"localized_name":"mask","name":"mask","type":"MASK","link":206}],"outputs":[],"properties":{"cnr_id":"comfy-core","ver":"0.3.59","widget_ue_connectable":{},"Node name for S&R":"MaskPreview","ue_properties":{"version":"7.0.1"}},"color":"#432","bgcolor":"#653"},{"id":36,"type":"PreviewImage","pos":[274.702392578125,-145.4186248779297],"size":[251.77528381347656,246],"flags":{"collapsed":false},"order":7,"mode":0,"inputs":[{"localized_name":"images","name":"images","type":"IMAGE","link":50}],"outputs":[],"properties":{"cnr_id":"comfy-core","ver":"0.3.59","widget_ue_connectable":{},"Node name for S&R":"PreviewImage","ue_properties":{"version":"7.0.1","widget_ue_connectable":{}}},"color":"#432","bgcolor":"#653"},{"id":47,"type":"MarkdownNote","pos":[-80.70278930664062,370.9444885253906],"size":[344.0520324707031,206.44210815429688],"flags":{},"order":1,"mode":0,"inputs":[],"outputs":[],"properties":{"ue_properties":{"version":"7.0.1","widget_ue_connectable":{}},"widget_ue_connectable":{}},"widgets_values":["## Here we resize the image, but keeping the aspect ratio\n## This is done adding black areas\n## Note that scaling to the trained size isn't always mandatory.  In most cases the size must be a multiple of 32. Some models needs an exact size."],"color":"#432","bgcolor":"#653"},{"id":120,"type":"MarkdownNote","pos":[990,-410],"size":[274.0300598144531,111.83796691894531],"flags":{},"order":2,"mode":0,"inputs":[],"outputs":[],"properties":{"ue_properties":{"version":"7.0.1","widget_ue_connectable":{}},"widget_ue_connectable":{}},"widgets_values":["# This is called a *map*\n\n## We use bicubic because this is gray scale mask, not just B/N"],"color":"#432","bgcolor":"#653"},{"id":72,"type":"MarkdownNote","pos":[1550,-80],"size":[278.8791809082031,120.8814468383789],"flags":{},"order":3,"mode":0,"inputs":[],"outputs":[],"properties":{"ue_properties":{"version":"7.0.1","widget_ue_connectable":{}},"widget_ue_connectable":{}},"widgets_values":["## From the image and the mask we can estimate the foreground\n\n## FMLFE is slow but better"],"color":"#432","bgcolor":"#653"},{"id":48,"type":"MarkdownNote","pos":[290,270],"size":[274.0300598144531,111.83796691894531],"flags":{"collapsed":true},"order":4,"mode":0,"inputs":[],"outputs":[],"properties":{"ue_properties":{"version":"7.0.1","widget_ue_connectable":{}},"widget_ue_connectable":{}},"widgets_values":["## We normalize the image to the trained stats"],"color":"#432","bgcolor":"#653"},{"id":34,"type":"GetMaskLowByBiRefNet_SET","pos":[611.5174560546875,175.32884216308594],"size":[303.6714782714844,122],"flags":{},"order":5,"mode":0,"inputs":[{"localized_name":"model","name":"model","type":"SET_REMBG","link":218},{"localized_name":"images","name":"images","type":"IMAGE","link":210},{"localized_name":"depths","name":"depths","shape":7,"type":"MASK","link":null},{"localized_name":"batch_size","name":"batch_size","type":"INT","widget":{"name":"batch_size"},"link":null},{"localized_name":"out_dtype","name":"out_dtype","shape":7,"type":"COMBO","widget":{"name":"out_dtype"},"link":null}],"outputs":[{"localized_name":"masks","name":"masks","type":"MASK","links":[197]},{"localized_name":"depths","name":"depths","type":"MASK","links":null},{"localized_name":"edges","name":"edges","type":"MASK","links":null}],"properties":{"aux_id":"set-soft/ComfyUI_BiRefNet_SET","ver":"450fdf2cb5ccb7f95a82bd9178033dc58a9d7dbc","widget_ue_connectable":{"batched":true},"Node name for S&R":"GetMaskLowByBiRefNet_SET","ue_properties":{"version":"7.0.1","widget_ue_connectable":{}}},"widgets_values":[1,"AUTO"],"color":"#2a363b","bgcolor":"#3f5159"},{"id":35,"type":"ResizeAndPadImage","pos":[-77.33975219726562,198.73716735839844],"size":[270,130],"flags":{"collapsed":false},"order":6,"mode":0,"inputs":[{"localized_name":"image","name":"image","type":"IMAGE","link":224},{"localized_name":"target_width","name":"target_width","type":"INT","widget":{"name":"target_width"},"link":219},{"localized_name":"target_height","name":"target_height","type":"INT","widget":{"name":"target_height"},"link":220},{"localized_name":"padding_color","name":"padding_color","type":"COMBO","widget":{"name":"padding_color"},"link":null},{"localized_name":"interpolation","name":"interpolation","type":"COMBO","widget":{"name":"interpolation"},"link":null}],"outputs":[{"localized_name":"IMAGE","name":"IMAGE","type":"IMAGE","links":[50,209]}],"properties":{"cnr_id":"comfy-core","ver":"0.3.59","widget_ue_connectable":{"target_width":true,"target_height":true,"padding_color":true,"interpolation":true},"Node name for S&R":"ResizeAndPadImage","ue_properties":{"version":"7.0.1","widget_ue_connectable":{"target_width":true,"target_height":true,"padding_color":true,"interpolation":true}}},"widgets_values":[512,512,"black","lanczos"],"color":"#232","bgcolor":"#353"},{"id":125,"type":"SET_ResizeMask","pos":[1000,190],"size":[270,194],"flags":{},"order":10,"mode":0,"inputs":[{"localized_name":"mask","name":"mask","type":"MASK","link":197},{"localized_name":"get_image_size","name":"get_image_size","shape":7,"type":"IMAGE","link":225},{"localized_name":"width","name":"width","type":"INT","widget":{"name":"width"},"link":null},{"localized_name":"height","name":"height","type":"INT","widget":{"name":"height"},"link":null},{"localized_name":"keep_proportions","name":"keep_proportions","type":"BOOLEAN","widget":{"name":"keep_proportions"},"link":null},{"localized_name":"upscale_method","name":"upscale_method","type":"COMBO","widget":{"name":"upscale_method"},"link":null},{"localized_name":"crop","name":"crop","type":"COMBO","widget":{"name":"crop"},"link":null}],"outputs":[{"localized_name":"mask","name":"mask","type":"MASK","links":[198,199,201,202,203,204,205,206,213]},{"localized_name":"width","name":"width","type":"INT","links":null},{"localized_name":"height","name":"height","type":"INT","links":null}],"properties":{"cnr_id":"image-misc","ver":"c976f3d057c81bf5230c28166874165469a07e67","widget_ue_connectable":{"width":true,"height":true,"keep_proportions":true,"upscale_method":true,"crop":true},"Node name for S&R":"SET_ResizeMask","ue_properties":{"version":"7.0.1"}},"widgets_values":[512,512,false,"bicubic","center"],"color":"#233","bgcolor":"#355"},{"id":71,"type":"SET_FMLFE","pos":[1540,100],"size":[285.0718688964844,218],"flags":{"collapsed":false},"order":9,"mode":0,"inputs":[{"localized_name":"images","name":"images","type":"IMAGE","link":227},{"localized_name":"masks","name":"masks","type":"MASK","link":199},{"localized_name":"implementation","name":"implementation","type":"COMBO","widget":{"name":"implementation"},"link":null},{"localized_name":"regularization","name":"regularization","shape":7,"type":"FLOAT","widget":{"name":"regularization"},"link":null},{"localized_name":"n_small_iterations","name":"n_small_iterations","shape":7,"type":"INT","widget":{"name":"n_small_iterations"},"link":null},{"localized_name":"n_big_iterations","name":"n_big_iterations","shape":7,"type":"INT","widget":{"name":"n_big_iterations"},"link":null},{"localized_name":"small_size","name":"small_size","shape":7,"type":"INT","widget":{"name":"small_size"},"link":null},{"localized_name":"gradient_weight","name":"gradient_weight","shape":7,"type":"FLOAT","widget":{"name":"gradient_weight"},"link":null}],"outputs":[{"localized_name":"foreground","name":"foreground","type":"IMAGE","links":[127,154,155,156,157]},{"localized_name":"background","name":"background","type":"IMAGE","links":null},{"localized_name":"mask","name":"mask","type":"MASK","links":null}],"properties":{"cnr_id":"image-misc","ver":"87ee4aebb77a731442e41b595bc8b12a6fd263c3","widget_ue_connectable":{"implementation":true,"regularization":true,"n_small_iterations":true,"n_big_iterations":true,"small_size":true,"gradient_weight":true},"Node name for S&R":"SET_FMLFE","ue_properties":{"version":"7.0.1","widget_ue_connectable":{"implementation":true,"regularization":true,"n_small_iterations":true,"n_big_iterations":true,"small_size":true,"gradient_weight":true}}},"widgets_values":["auto",0.00001,10,2,32,1],"color":"#233","bgcolor":"#355"},{"id":128,"type":"SET_NormalizeArbitrary","pos":[290,180],"size":[220,50],"flags":{"collapsed":false},"order":12,"mode":0,"inputs":[{"localized_name":"image","name":"image","type":"IMAGE","link":209},{"localized_name":"parameters","name":"parameters","type":"NORM_PARAMS","link":221}],"outputs":[{"localized_name":"image","name":"image","type":"IMAGE","links":[210]}],"properties":{"cnr_id":"image-misc","ver":"c5060bafe6c27649075dd61e686aae7fb54850db","widget_ue_connectable":{},"Node name for S&R":"SET_NormalizeArbitrary","ue_properties":{"version":"7.0.1","widget_ue_connectable":{}}},"color":"#233","bgcolor":"#355"}],"groups":[{"id":1,"title":"Resize mask to image size","bounding":[975,100,320,300],"color":"#3f789e","font_size":24,"flags":{}}],"links":[{"id":198,"origin_id":125,"origin_slot":0,"target_id":53,"target_slot":1,"type":"MASK","parentId":38},{"id":199,"origin_id":125,"origin_slot":0,"target_id":71,"target_slot":1,"type":"MASK","parentId":38},{"id":206,"origin_id":125,"origin_slot":0,"target_id":126,"target_slot":0,"type":"MASK"},{"id":50,"origin_id":35,"origin_slot":0,"target_id":36,"target_slot":0,"type":"IMAGE"},{"id":209,"origin_id":35,"origin_slot":0,"target_id":128,"target_slot":0,"type":"IMAGE"},{"id":197,"origin_id":34,"origin_slot":0,"target_id":125,"target_slot":0,"type":"MASK"},{"id":210,"origin_id":128,"origin_slot":0,"target_id":34,"target_slot":1,"type":"IMAGE"},{"id":127,"origin_id":71,"origin_slot":0,"target_id":-20,"target_slot":0,"type":"*","parentId":24},{"id":154,"origin_id":71,"origin_slot":0,"target_id":-20,"target_slot":0,"type":"*","parentId":24},{"id":155,"origin_id":71,"origin_slot":0,"target_id":-20,"target_slot":0,"type":"*","parentId":24},{"id":156,"origin_id":71,"origin_slot":0,"target_id":-20,"target_slot":0,"type":"*","parentId":24},{"id":157,"origin_id":71,"origin_slot":0,"target_id":-20,"target_slot":0,"type":"*","parentId":24},{"id":201,"origin_id":125,"origin_slot":0,"target_id":-20,"target_slot":1,"type":"*","parentId":26},{"id":202,"origin_id":125,"origin_slot":0,"target_id":-20,"target_slot":1,"type":"*","parentId":26},{"id":203,"origin_id":125,"origin_slot":0,"target_id":-20,"target_slot":1,"type":"*","parentId":33},{"id":204,"origin_id":125,"origin_slot":0,"target_id":-20,"target_slot":1,"type":"*","parentId":34},{"id":205,"origin_id":125,"origin_slot":0,"target_id":-20,"target_slot":1,"type":"*","parentId":34},{"id":213,"origin_id":125,"origin_slot":0,"target_id":-20,"target_slot":1,"type":"MASK","parentId":43},{"id":218,"origin_id":-10,"origin_slot":0,"target_id":34,"target_slot":0,"type":"SET_REMBG","parentId":45},{"id":219,"origin_id":-10,"origin_slot":1,"target_id":35,"target_slot":1,"type":"INT"},{"id":220,"origin_id":-10,"origin_slot":2,"target_id":35,"target_slot":2,"type":"INT"},{"id":221,"origin_id":-10,"origin_slot":3,"target_id":128,"target_slot":1,"type":"NORM_PARAMS","parentId":46},{"id":224,"origin_id":-10,"origin_slot":4,"target_id":35,"target_slot":0,"type":"IMAGE","parentId":49},{"id":225,"origin_id":-10,"origin_slot":4,"target_id":125,"target_slot":1,"type":"IMAGE","parentId":51},{"id":226,"origin_id":-10,"origin_slot":4,"target_id":53,"target_slot":0,"type":"IMAGE","parentId":52},{"id":227,"origin_id":-10,"origin_slot":4,"target_id":71,"target_slot":0,"type":"IMAGE","parentId":52}],"reroutes":[{"id":25,"parentId":38,"pos":[1450,-220],"linkIds":[201,202,203,204,205]},{"id":38,"pos":[1370,200],"linkIds":[198,199,201,202,203,204,205,213]},{"id":42,"parentId":38,"pos":[1512.9076924816798,328.3531173483972],"linkIds":[213]},{"id":43,"parentId":42,"pos":[1902.6635785502883,327.69141679678785],"linkIds":[213]},{"id":44,"pos":[150,125],"linkIds":[218]},{"id":45,"parentId":44,"pos":[575,125],"linkIds":[218]},{"id":46,"pos":[200,150],"linkIds":[221]},{"id":49,"pos":[-200,225],"linkIds":[224,225,226,227]},{"id":50,"parentId":49,"pos":[-100,600],"linkIds":[225,226,227]},{"id":51,"parentId":50,"pos":[900,600],"linkIds":[225,226,227]},{"id":52,"parentId":51,"pos":[1425,450],"linkIds":[226,227]}],"extra":{}}]}}
